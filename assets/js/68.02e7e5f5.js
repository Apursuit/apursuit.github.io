(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{430:function(s,a,e){"use strict";e.r(a);var t=e(7),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"使用docker搭建ctf简单镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用docker搭建ctf简单镜像"}},[s._v("#")]),s._v(" 使用Docker搭建CTF简单镜像")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("推荐")]),s._v(" "),a("p",[s._v("如果你在找lnmp相关ctf web基础镜像，推荐Github这个项目"),a("a",{attrs:{href:"https://github.com/CTF-Archives/ctf-docker-template/tree/main",target:"_blank",rel:"noopener noreferrer"}},[s._v("ctf-docker-template"),a("OutboundLink")],1),s._v("，很多现成web镜像，感谢大佬们的贡献")])]),s._v(" "),a("p",[s._v("需求：一个可以快速上手，简单配置搭建CTF靶机的镜像("),a("strong",[s._v("php+apache")]),s._v(")")]),s._v(" "),a("p",[s._v("我要打的靶机需要修改一些PHP配置，以我的过程为例了")]),s._v(" "),a("blockquote",[a("p",[s._v("中间php.ini配置部分按需求选做")])]),s._v(" "),a("h2",{attrs:{id:"拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像"}},[s._v("#")]),s._v(" 拉取镜像")]),s._v(" "),a("p",[s._v("确定需求，在Dockerhub官网中搜索PHP，官方给出很多镜像，在标签页找php-apache相关镜像")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/1.png",alt:"1"}})]),s._v(" "),a("p",[s._v("选择一个没有其他组件的镜像")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/2.png",alt:"2"}})]),s._v(" "),a("p",[s._v("命令行拉取镜像，在下面开启容器时，可以使用这个镜像名或者这个分配的sha256的前5位也可以")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull php:8.2.17-apache\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"准备src目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备src目录"}},[s._v("#")]),s._v(" 准备src目录")]),s._v(" "),a("p",[s._v("在拉取的镜像中没有图像化界面,vi等编辑器，可以简单用echo临时写个简单php测试一下，写简单靶机题目有点不够用~(实力不够)~"),a("br"),s._v("\n在主机/虚拟机中准备src目录，使用你的编辑器/vi写入题目，配置文件，这样待会可以直接复制到镜像中("),a("strong",[s._v("没有特殊需求，不用准备配置文件，使用镜像中默认的")]),s._v(")")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/5.png",alt:"5"}})]),s._v(" "),a("p",[s._v("配置文件中"),a("strong",[s._v("修改需要的相关参数")]),s._v("(选做)")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/6.png",alt:"6"}})]),s._v(" "),a("h2",{attrs:{id:"修改php配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改php配置"}},[s._v("#")]),s._v(" 修改PHP配置")]),s._v(" "),a("p",[s._v("我需要用到PHP配置中include和伪协议，需要打开配置中的allow_url_include，allow_url_fopen，如果你不需要修改配置，忽略此步")]),s._v(" "),a("p",[s._v("在Dockerhub中PHP官方文档下找到配置相关指令")]),s._v(" "),a("p",[s._v("找到"),a("strong",[s._v("配置文件位置")])]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$php_INI_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("php"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("ini      \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/4.png",alt:"4"}})]),s._v(" "),a("h2",{attrs:{id:"开启容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启容器"}},[s._v("#")]),s._v(" 开启容器")]),s._v(" "),a("p",[s._v("开启容器")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[s._v("docker run -d -p 8080:80 php:8.2.17-apache\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看正在运行的容器")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[s._v("docker ps\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("已经开启容器了，进去看看(滑稽)\n"),a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/8.png",alt:"8"}})]),s._v(" "),a("p",[s._v("没有权限访问：官方镜像/var/www/html目录下没有准备文件，所以报错了，你需要自己准备")]),s._v(" "),a("p",[s._v("你可以记录下这个容器的id，后面使用更简单\n"),a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/7.png",alt:"7"}})]),s._v(" "),a("h2",{attrs:{id:"配置文件复制到容器中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件复制到容器中"}},[s._v("#")]),s._v(" 配置文件复制到容器中")]),s._v(" "),a("p",[s._v("将src下准备的配置文件复制到容器的临时存放目录下")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[s._v("docker cp src/php.ini-development fb204:/tmp/php.ini-development\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("现在你可以将主机/虚拟机src下的ini配置文件删掉了，后面src目录下index.php，flag.php还会用")]),s._v(" "),a("h2",{attrs:{id:"正确配置php-ini文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正确配置php-ini文件"}},[s._v("#")]),s._v(" 正确配置php.ini文件")]),s._v(" "),a("p",[s._v("上一步将PHP配置文件复制到了/tmp目录下，并不会生效，我们要进容器修改配置到正确的目录下")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[s._v("docker exec -it fb204 /bin/bash    # 进入容器\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("移动配置文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /tmp/php.ini-development "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PHP_INI_DIR")]),s._v("/php.ini\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/9.png",alt:"9"}})]),s._v(" "),a("p",[s._v("现在你已经把配置文件放到正确的目录下了，看起来可以达到预期了(滑稽)")]),s._v(" "),a("h2",{attrs:{id:"将php文件复制到工作目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将php文件复制到工作目录"}},[s._v("#")]),s._v(" 将PHP文件复制到工作目录")]),s._v(" "),a("p",[s._v("先退出容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/11.png",alt:"11"}}),s._v("\n将src目录下PHP文件复制到工作目录下，测试php-apache能否正确运行")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[s._v("docker cp src/. fb204:/var/www/html/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"访问测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问测试"}},[s._v("#")]),s._v(" 访问测试")]),s._v(" "),a("p",[s._v("再访问网页看看效果，PHP文件正确解析\n"),a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/12.png",alt:"12"}})]),s._v(" "),a("p",[s._v("传参查看"),a("strong",[s._v("phpinfo()")]),s._v(",发现allow_url_include没有被修改~(慌)~\n"),a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/13.png",alt:"13"}})]),s._v(" "),a("p",[s._v("当然，在容器中修改配置文件并不会立即生效，你需要保存镜像中的修改，所以commit将当前容器构建成新的镜像")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[s._v("docker commit fb204 ajay\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("~下面操作一气呵成~")]),s._v(" "),a("ul",[a("li",[s._v("生成新镜像")]),s._v(" "),a("li",[s._v("停止刚才的容器")]),s._v(" "),a("li",[s._v("运行新生成的镜像(刚才容器的最后状态)")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/15.png",alt:"15"}})]),s._v(" "),a("p",[s._v("现在再次访问测试可以发现参数已经完成修改！\n"),a("img",{attrs:{src:"https://the0n3.top/medias/docker_0/14.png",alt:"14"}})]),s._v(" "),a("h2",{attrs:{id:"将镜像推送到dockerhub仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将镜像推送到dockerhub仓库"}},[s._v("#")]),s._v(" 将镜像推送到dockerhub仓库")]),s._v(" "),a("p",[s._v("登录dockerhub账户")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[s._v("docker login\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("给本地镜像打标签")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[s._v("docker tag myimage:latest  mynamespace/myrepo:1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("推送镜像到dockerhub仓库")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[s._v("docker push mynamespace/myrepo:1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);