---
title: 新版flask无法访问console的问题解决 2024
date: 2024-10-15 15:46:50
permalink: /pages/883507/
sidebar: false
author: 
  name: Cola
  link: https://the0n3.top
---

在虚拟机、容器的flask服务，其他主机可以正常访问已定义的路由，在访问`console`时返回400，通过buuctf平台`[GYCTF2020]FlaskApp`题目，查看配置及环境变量，得出是flask版本的问题，需要低版本才能允许其他主机正常访问`console`控制台

![0](https://the0n3.top/medias/flask-console/0.png)

使用低版本flask以及其他适配的组件，还可以实现允许其他用户访问`console`控制台

![1](https://the0n3.top/medias/flask-console/1.png)

::: tip 
如果要编译镜像，准备好了模板，在[这里](https://github.com/Apursuit/ctf-flaskPIN-Debug)
:::


## 描述

问题描述：

在虚拟机、容器等环境中开启的flask服务，除了开启服务的本地`localhost/console`可以访问`console`，其他机器无法访问`console`，访问会返回400

原因：

flask高版本不支持非本地用户访问`console`，复现环境需要降级flask,Jinja2等组件

## 环境搭建/问题解决

::: tip 环境
- python3-venv
- Flask==1.1.1
- Jinja2==2.11.3
- MarkupSafe==1.1.1
- Werkzeug==1.0.1
- itsdangerous==1.1.0
:::


::: warning
为避免其他可能在复现本环境的师傅主机环境，下面演示过程在`venv`虚拟环境中进行
:::


安装 venv 模块

```bash
sudo apt install python3-venv
```

创建虚拟环境`flask1.1.1`

```bash
python3 -m venv flask1.1.1
```

激活虚拟环境
```bash
source flask1.1.1/bin/activate
```

::: danger
- 可以执行下面的第一条指令就完成所需环境的安装

- 如果你是没有接触过的新手，可以按照下面第一条命令后的步骤一步步按照所需要的组件
:::

```bash
pip install Flask==1.1.1 Jinja2==2.11.3 MarkupSafe==1.1.1 Werkzeug==1.0.1 itsdangerous==1.1.0
```


安装特定版本的 Flask 和 Jinja2
```bash
pip install Flask==1.1.1
pip install Jinja2==2.11.3  # 适用于 Flask 1.1.1 的兼容版本
```

安装兼容版本的 MarkupSafe

```bash
pip install MarkupSafe==1.1.1
```

降级 Werkzeug

```bash
pip install Werkzeug==1.0.1
```

安装itsdangerous 

```bash
pip install itsdangerous==1.1.0
```

示例`app.py`

```python
from flask import Flask, request, render_template_string

app = Flask(__name__)

@app.route('/', methods=['GET'])
def hello_world():
    name = request.args.get('name', 'world')
    return render_template_string(f"Hello, {name}!")

if __name__ == '__main__':
    app.run(debug=True, port=8080, host='0.0.0.0')
```

启动服务
```bash
python3 app.py
```

访问`console`就可以拿着pin码去玩耍了

![3](https://the0n3.top/medias/flask-console/3.png)

![2](https://the0n3.top/medias/flask-console/2.png)

退出虚拟环境
```bash
deactivate
```